name: Auto Crawl & Vector DB

on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  crawl_vector:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          pip install --upgrade pip
          pip install uv

          uv pip install --system selenium chromedriver-autoinstaller openpyxl pandas
          uv pip install --system \
            langchain==0.0.27 \
            langchain-core==1.0.3 \
            langchain-openai==0.3.34 \
            langchain-huggingface==1.0.1 \
            langchain-text-splitters==1.0.0 \
            langchain-community==0.4.1 \
            langchain-chroma==0.2.6 \
            chromadb==1.1.0 \
            sentence-transformers==5.1.1 \
            pydantic==2.11.9 || pip install pydantic==2.11.9

      - name: Run crawler
        run: python crawler.py

      - name: Convert MD â†’ TXT
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: python txt_transfer.py

      - name: Build Vector DB
        run: python vector_store.py

      - name: Push Vector DB to LLM Repo
        env:
          TARGET_REPO_PAT: ${{ secrets.TARGET_REPO_PAT }}
          TARGET_REPO: "KNUckle-llm/chatbot"
          TARGET_BRANCH: "14-feature-auto-embedding"
        run: python src/agent/push_vector.py
